{% extends 'adminlte/base.html' %}
{% block body_class %}
  {% block bodyclass %}
    sidebar-collapse
  {% endblock %}
{% endblock %}

{% load static %}

{% block title %}
  Arslan Alüminyum
{% endblock %}

{% block stylesheets %}
  {% include 'adminlte/lib/_styles.html' %}
  <link rel="stylesheet" type="text/css" href="{% static 'tabulator/dist/css/tabulator_bootstrap5.min.css' %}">
  <!-- daterange picker -->
  <link rel="stylesheet" href="{% static 'admin-lte/plugins/daterangepicker/daterangepicker.css' %} ">
 <link rel="stylesheet" href="{% static 'ArslanTakipApp/raltohex-background.min.css' %}">
  <link rel="stylesheet" href="{% static 'ArslanTakipApp/raltohex-color.css' %}">
  <link rel="stylesheet" href="{% static 'admin-lte/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}">
  <link rel="stylesheet" href="{% static 'admin-lte/plugins/toastr/toastr.min.css' %}">
  <link rel="stylesheet" href="{% static 'admin-lte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'node_modules/file-icon-vectors/dist/file-icon-vectors.min.css' %}">
  <style>
    .required-info {
    border: 1px solid red;
    }

    /* Green border when required fields are filled */
    .validated {
    border: 1px solid green;
    }

    .toast-orta-center { 
        top: 30%;   
        margin: 0 auto;  
        left: 50%;   
        margin-left: -150px;
    }
    .toast-title {
        font-size: x-large;
    }
    .toast-message {
        font-size: x-large;
    }
    .custom-file-input ~ .custom-file-label::after {
        content: "Gözat";
    }
    .fiv-cla, .fiv-viv, .fiv-sqo { font-size: 3.5em; }
    .overflow {
        display: block;
        white-space: nowrap;
        width: 250px; 
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .nav-link.active[href="#ytab_home"],
    .nav-link.active[href="#ytab_home"]:hover,
    .nav-link.active[href="#ytab_home"]:focus {
        background-color: #007bff; /* Change this color to match your primary color */
        color: #ffffff; /* Text color for active tab */
    }
  </style>

{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card">
        <div class="card-header d-flex p-0">
            <h3 class="card-title p-3">YENİ ÜRÜN DEVREYE ALMA FORMU</h3>

            <ul class="nav nav-pills ml-auto p-2">
              <li class="nav-item"><a class="nav-link active" href="#tab_proje" data-toggle="tab">Proje</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_1" data-toggle="tab">Sipariş</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_2" data-toggle="tab" onclick="toastClick('info', 'Müşteri Alaşım belirtmediyse 6060 ya da 6063, Kondüsyon belirtmediyse T66 seçin.', 'br')">Alaşım ve Kondüsyon</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_3" data-toggle="tab" onclick="toastClick('info', 'Müşteri tolerans belirtmediyse EN 755-9 seçin.', 'br')">Tolerans</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_4" data-toggle="tab">Yüzey</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_5" data-toggle="tab">Talaşlı İmalat</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_6" data-toggle="tab">Paketleme</a></li>
              <li class="nav-item"><a class="nav-link" href="#tab_7" data-toggle="tab">Dosya</a></li>
            </ul>
        </div><!-- /.card-header -->
        <div class="card-body" id="formBody">
        <form enctype="multipart/form-data" action="" method="post" id="yudaForm">
            <div class="tab-content">
                <div class="tab-pane active" id="tab_proje">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-8" style="margin: auto;">
                                    <div class="info-box bg-light">
                                        <div class="info-box-content">
                                        <div class="btn-group btn-group-toggle col-12" data-toggle="buttons">
                                            <label class="btn btn-outline-danger">
                                            <input type="radio" class="kaydet" name="ProjeTipi" id="mevcutProfil" value="MevcutProfil" autocomplete="off" required> MEVCUT PROFİL
                                            </label>
                                            <label class="btn btn-outline-danger">
                                            <input type="radio" class="kaydet" name="ProjeTipi" id="yeniProje" value="YeniProje" autocomplete="off" required> YENİ PROJE
                                            </label>
                                        </div>
                                        </div>
                                  </div>
                                </div>
                            </div>
                            <div class="row" id="profilRow" style="display: none;">
                                <div class="col-8" style="margin: auto;">
                                    <div class="info-box bg-light required-info">
                                        <div class="info-box-content">
                                            <span class="info-box-text text-center text-bold">PROFİL*</span>
                                            <!-- multiselect ile seçilsin select2 -->
                                            <div class="form-group mt-3">
                                                <select class="select2bs4 kaydet" multiple="multiple" id="profilSelect" name="MevcutProfil" data-placeholder="Profil Seçiniz" style="width: 100%;">
                                                    <option value=""></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_1">
                    <div class="card">
                        <div class="card-header">Sipariş Detayları</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light  required-info">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">MÜŞTERİ FİRMA ADI*</span>
                                      <input type="text" name="MusteriFirmaAdi" id="musteriFirmaAdi" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()" required>
                                      <!-- <span class="info-box-number text-center text-muted mb-0">var-yok</span> -->
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">SON KULLANICI FİRMA</span>
                                      <input type="text" name="SonKullaniciFirma" id="sonKullaniciFirma" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()" placeholder="Paylaşıldıysa lütfen girin">
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">PROFİLİN KULLANILDIĞI YER</span>
                                      <input type="text" name="KullanimAlani" id="kullanimAlani" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()" placeholder="ÖRN: Solar Otomotiv..">
                                    </div>
                                  </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">MÜŞTERİ RESİM/PARÇA NO</span>
                                      <input type="text" name="CizimNo" id="cizimNo" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()">
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light required-info">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">PROFİL SİPARİŞİ*</span>
                                      <div class="input-group mt-2">
                                        <input type="text" oninput="this.value = formatNumber(this.value)" placeholder="kg" name="YillikProfilSiparisiMiktar" id="yillikProfilSiparisi" class="form-control kaydet" required>
                                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                            <label class="btn btn-outline-danger active">
                                                <input type="radio" name="ProfilMiktarBirim" id="birimKg" class="kaydet is-warning" value="kg" autocomplete="off" required> KG
                                              </label>
                                              <label class="btn btn-outline-danger">
                                                <input type="radio" name="ProfilMiktarBirim" id="birimAdet" class="kaydet" value="adet" autocomplete="off" required> ADET
                                              </label>
                                        </div>
                                        <span class="input-group-text" style="font-weight: bold;">/</span>
                                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                            <label class="btn btn-outline-danger active">
                                              <input type="radio" name="ProfilSip" id="sipHafta" class="kaydet" value="HAFTA" autocomplete="off" required> HAFTA
                                            </label>
                                            <label class="btn btn-outline-danger">
                                              <input type="radio" name="ProfilSip" id="sipAy" class="kaydet" value="AY" autocomplete="off" required> AY
                                            </label>
                                            <label class="btn btn-outline-danger">
                                              <input type="radio" name="ProfilSip" id="sipYil" class="kaydet" value="YIL" autocomplete="off" required> YIL
                                            </label>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold">MÜŞTERİ ÖDEME VADESİ</span>
                                      <input type="text" name="MusteriOdemeVadesi" id="musteriOdemeVadesi" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()">
                                    </div>
                                  </div>
                                </div>
                            </div>
                            {% if not is_in_group %}
                            <div class="row">
                                <div class="col-12 col-sm-4">
                                  <div class="info-box bg-light">
                                    <div class="info-box-content">
                                      <span class="info-box-text text-center text-bold mb-2">YETKİ</span>
                                      <div class="btn-group btn-group-toggle col-12" data-toggle="buttons">
                                        <label class="btn btn-outline-danger">
                                        <input type="radio" class="kaydet" name="Yetki" id="yurtIci" value="Yurt Ici Satis Bolumu" autocomplete="off" required> YURT İÇİ SATIŞ
                                        </label>
                                        <label class="btn btn-outline-danger">
                                        <input type="radio" class="kaydet" name="Yetki" id="yurtDisi" value="Yurt Disi Satis Bolumu" autocomplete="off" required> YURT DIŞI SATIŞ
                                        </label>
                                    </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_2">
                    <div class="card">
                        <div class="card-header">Alaşım ve Kondüsyon Detayları</div>
                        <div class="card-body">
                            <div class="row" id="alasimKondusyonRow">
                                <div class="col-lg-2">
                                    <div class="form-group">
                                    <select name="AlasimSelect" class="form-control" id="alasimSelect" onchange="selectFunction(this.value, 'kondusyonSelect', 'Alaşım', 'Diğer'); if(this.value==0){digerFunction('alasimSelect', 'alasimDigerDiv')}">
                                        <option value="alasimSelected" id="alasimSelected" selected disabled>Alaşım* </option>
                                        
                                    </select>
                                    <div class="input-group" id="alasimDigerDiv" style="display: none;">
                                        <input type="text" class="form-control" name="AlasimDiger" placeholder="Alaşım" id="alasimDiger" oninput="this.value = this.value.toUpperCase()">
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="alasimDigerSpan" onclick="digerFunction('alasimDigerDiv', 'alasimSelect')"><i class="fa fa-undo" aria-hidden="true"></i></span>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="form-group">
                                    <select name="KondusyonSelect" class="form-control" id="kondusyonSelect" onchange="selectFunction(this.value, '', 'Kondüsyon', 'Diğer'); if(this.value==0){digerFunction('kondusyonSelect', 'kondusyonDigerDiv')}">
                                        <option value="kondusyonSelected" id="kondusyonSelected" selected disabled>Kondüsyon* </option>
                                        
                                    </select>
                                    <div class="input-group" id="kondusyonDigerDiv" style="display: none;">
                                        <input type="text" class="form-control" placeholder="Kondüsyon" id="kondusyonDiger" oninput="this.value = this.value.toUpperCase()">
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="kondusyonDigerSpan" onclick="digerFunction('kondusyonDigerDiv', 'kondusyonSelect')"><i class="fa fa-undo" aria-hidden="true"></i></span>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="form-group">
                                    <button type="button" id="AlasimKondusyonEkle" class="btn btn-outline-danger" >Ekle</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="info-box bg-light">
                                        <div class="info-box-content">
                                            <div id="alasimTabulator"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input type="text" name="AlasimKondusyon" id="alasimTabData" style="display: none;" class="kaydet" required>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_3">
                    <div class="card">
                        <div class="card-header">Tolerans Detayları</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 col-sm-4">
                                    <div class="info-box bg-light required-info">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">DIN TOLERANS*</span>
                                        <select name="DinTolerans" id="dinTolerans" class="form-control mb-3 mt-3 kaydet" onchange="if(this.value=='Diger'){toastClick('info','Lütfen şartname dosyasını ekleyin!','')}else if(this.value=='EN 755-7'){toastClick('warning','DİKİŞSİZ BORU ÜRETİMİMİZ YOKTUR!','')}" required>
                                            <option value="" selected disabled>Tolerans seçiniz</option>
                                            <option value="EN 755-3">EN 755-3   Yuvarlak Dolu</option>
                                            <option value="EN 755-4">EN 755-4   Kare Dolu</option>
                                            <option value="EN 755-5">EN 755-5   Diktörtgen Dolu (Lama)</option>
                                            <option value="EN 755-6">EN 755-6   Altıgen Dolu</option>
                                            <option value="EN 755-7">EN 755-7   Dikişsiz Boru</option>
                                            <option value="EN 755-8">EN 755-8   Dikişli Boru (Portol)</option>
                                            <option value="EN 755-9">EN 755-9   Profil</option>
                                            <option value="EN 12020-2">EN 12020-2   Profiller için hassas tolerans</option>
                                            <option value="Diger">Diğer</option>
                                        </select>
                                    </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                    <div class="info-box bg-light required-info">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">BİRLİKTE ÇALIŞAN APARATI VAR MI*</span>
                                        <!-- multiselect ile seçilsin select2 -->
                                        <div class="form-group mt-3">
                                            <select class="select2bs4 kaydet" multiple="multiple" id="birlikteCalisan" name="BirlikteCalisan" data-placeholder="Select a State" style="width: 100%;" required>
                                                <option value="Birlikte Çalışan Aparatı Var">Aparatı Var</option>
                                                <option value="Kendisiyle Çalışır">Kendisiyle Çalışır</option>
                                                <option value="Birlikte Çalışan Aparatı Yok">Yok</option>
                                            </select>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-4">
                                    <div class="info-box bg-light">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">Metre Ağırlık Talebi</span>
                                        <div class="row mb-3 mt-3">
                                            <div class="input-group col-lg-12">
                                                <div class="input-group-prepend">
                                                <span class="input-group-text checkSpan" id="metreSpan">
                                                    <input type="checkbox" class="metreCheckbox kaydet" name="MetreAgirlikTalebi" id="metreCheckbox">
                                                </span>
                                                </div>
                                                <input type="text" class="form-control metreInput" value="VAR" style="background-color: transparent;" readonly>
                                                <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control col-lg-4 kaydet" placeholder="minimum (kg/m)" name="MATmin" id="minMAT" style="display: none;">
                                                <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control col-lg-4 kaydet" placeholder="maximum (kg/m)" name="MATmax" id="maxMAT" style="display: none;">
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 ">
                                    <div class="info-box bg-light">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">ÖNEMLİ ÖLÇÜLER VE TOLERANSLAR</span>
                                        <textarea name="OnemliOlculer" class="form-control mt-3 kaydet" id="onemliOlculer" rows="5" placeholder="Özellikle dikkat edilecek ölçü bilgisi" oninput="this.value = this.value.toUpperCase()"></textarea>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_4">
                    <div class="card card-primary card-tabs">
                        <div class="card-header d-flex p-0">
                            <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                <!-- <li class="pt-2 px-3"><h3 class="card-title">Yüzey Detayları</h3></li> -->
                                <li class="nav-item">
                                    <a class="nav-link active" id="custom-tabs-two-home-tab" data-toggle="pill" href="#ytab_home" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true" style="color: #ffffff;"><i class="fa fa-question-circle" aria-hidden="true"></i></a>
                                  </li>
                                <li class="nav-item">
                                  <a class="nav-link" id="custom-tabs-two-pres-tab" data-toggle="pill" href="#ytab_1" role="tab" aria-controls="custom-tabs-two-pres" aria-selected="true">Pres</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" id="custom-tabs-two-eloksal-tab" data-toggle="pill" href="#ytab_2" role="tab" aria-controls="custom-tabs-two-eloksal" aria-selected="false" onclick="toastClick('info', 'Eloksal Arslan Alüminyum tarafından yapılacaksa doldurunuz.', 'br')">Eloksal</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" id="custom-tabs-two-boya-tab" data-toggle="pill" href="#ytab_3" role="tab" aria-controls="custom-tabs-two-boya" aria-selected="false" onclick="toastClick('info', 'Boya Arslan Alüminyum tarafından yapılacaksa doldurunuz.', 'br')">Boya</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" id="custom-tabs-two-ahsap-tab" data-toggle="pill" href="#ytab_4" role="tab" aria-controls="custom-tabs-two-ahsap" aria-selected="false" onclick="toastClick('info', 'Ahşap Kaplama Arslan Alüminyum tarafından yapılacaksa doldurunuz.', 'br')">Ahşap Kaplama</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="ytab_home">
                                    <div class="row">
                                        <ul>
                                            <li>Müşteriye pres olarak sevk edilecekse Pres Sekmesinde "Pres Yüzey" seçiniz.</li>
                                            <li>Eloksal işlemi müşteri tarafından yapılacak ise Pres Sekmesinde "Eloksal Kalite" seçiniz. Arslan Alüminyum tarafından yapılacak ise Eloksal sekmesini kullanın.</li>
                                            <li>Eloksal işlemi müşteri tarafından yapılacak ise Pres Sekmesinde "Parlak Eloksal" seçiniz. Arslan Alüminyum tarafından yapılacak ise Eloksal sekmesini kullanın.</li>
                                            <li>Boya işlemi müşteri tarafından yapılacak ise Pres Sekmesinde "Boya Kalite" seçiniz. Arslan Alüminyum tarafından yapılacak ise Boya sekmesini kullanın.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="ytab_1">
                                    <div class="row">
                                        <div class="form-group col-lg-4">
                                            <select name="presYuzeyDetay" id="yuzeyPresSelect" class="form-control" onchange="if(this.value == 'Pres Yüzey'){toastClick('info', 'Müşteriye Pres olarak sevk edilecekse doldurunuz', 'br')}
                                                                                                                    else if (this.value =='Eloksal Kalite' || this.value == 'Parlak Eloksal'){toastClick('info','Eloksal işlemi müşteri tarafından yapılacak ise doldurun. Arslan Alüminyum tarafından yapılacak ise Eloksal sekmesini kullanın. ','br')}
                                                                                                                    else if(this.value == 'Boya Kalite'){toastClick('info', 'Boya işlemi müşteri tarafından yapılacak ise doldurun. Arslan Alüminyum tarafından yapılacak ise Boya sekmesini kullanın. ','br')}">
                                                <option value="yuzeyPresDetay" id="yuzeyPresSelected" selected disabled>Yüzey Detay</option>
                                                <option value="Pres Yüzey">Pres Yüzey</option>
                                                <option value="Eloksal Kalite">Eloksal Kalite</option>
                                                <option value="Boya Kalite">Boya Kalite</option>
                                                <option value="Parlak Eloksal">Parlak Eloksal</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-1">
                                            <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control" placeholder="Boy (mm)" min="0" max="15000" name="yPresBoy" id="yuzeyPresBoy">
                                        </div>
                                        <div class="form-group col-lg-1">
                                            <button type="button" id="YuzeyPresEkle" class="btn btn-outline-primary" >Ekle</button>
                                        </div> 
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="info-box">
                                                <div class="info-box-content">
                                                    <div id="yuzeyPresTabulator"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="text" name="YuzeyPres" id="yPresTabData" class="kaydet" style="display: none;" required>
                                </div>
                                <div class="tab-pane fade" id="ytab_2">
                                        <div class="row">
                                            <div class="col-lg-2">
                                                <div class="form-group">
                                                <select name="matlastirmaSelect" class="form-control" id="matlastirmaSelect" onchange="selectFunction(this.value, 'eloksalRenkSelect', 'Matlaştırma', '')">
                                                    <option value="Matlaştırma" id="matlastirmaSelected" selected disabled>Matlaştırma </option>
                                                    
                                                </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-2">
                                                <div class="form-group">
                                                <select name="eloksalRenkSelect" class="form-control" id="eloksalRenkSelect">
                                                    <option value="Renk" id="eloksalRenkSelected" selected disabled>Renk </option>
                                                    
                                                </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-2">
                                                <div class="form-group">
                                                <select name="kaplamaKalinlikSelect" class="form-control" id="eloksalKaplamaKalinligiSelect" onchange="selectFunction(this.value, '', 'Kaplama Kalınlığı', 'Diğer')">
                                                    <option value="Kaplama Kalınlığı" id="kaplamaKalinlikSelected" selected disabled>Kaplama Kalınlığı </option>
                                                    
                                                </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-1">
                                                <div class="form-group">
                                                    <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control" placeholder="Boy (mm)" name="eloksalBoy" min="0" id="eloksalBoy">
                                                </div>
                                            </div>
                                            <div class="col-lg-2 form-group">
                                                <div class="row">
                                                <div class="input-group col-lg-8">
                                                    <div class="input-group-prepend">
                                                      <span class="input-group-text checkSpan">
                                                        <input type="checkbox" class="temizCheckbox" id="eloksalTemiz">
                                                      </span>
                                                    </div>
                                                    <input type="text" class="form-control temizInput" value="Temiz Kesim" style="background-color: transparent;" readonly>
                                                </div>
                                                <div class="col-lg-4" >
                                                    <button type="button" id="YuzeyEloksalEkle" class="btn btn-outline-primary">Ekle</button>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="info-box">
                                                    <div class="info-box-content">
                                                        <div id="eloksalTabulator"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <input type="text" name="YuzeyEloksal" class="kaydet" id="yEloksalTabData" style="display: none;" required>
                                </div>
                                <div class="tab-pane fade" id="ytab_3">
                                    <div class="row">
                                        <div class="form-group col-lg-1">
                                            <select name="turSelect" id="turSelect" class="form-control">
                                                <option value="Tür" id="turSelected" selected disabled>Tür </option>
                                            </select>
                                        </div>
                                        <div class="col-lg-5">
                                        <div class="row">
                                            <div class="input-group col-lg-9">
                                                <select name="boyaMarkaSelect" id="boyaMarkaSelect" class="form-control col-lg-4" onchange="if(this.value==0){digerFunction('boyaMarkaSelect', 'boyaMarkaDiger, #boyaDigerSpan')}">
                                                    <option value="boyaMarkaSelected" id="boyaMarkaSelected" selected disabled>Marka</option>
                                                </select>
                                                <input type="text" class="form-control" id="boyaMarkaDiger" style="display: none;" oninput="this.value = this.value.toUpperCase()">
                                                <span class="input-group-text" id="boyaDigerSpan" style="display: none;" onclick="digerFunction('boyaDigerSpan, #boyaMarkaDiger', 'boyaMarkaSelect')"><i class="fa fa-undo" aria-hidden="true"></i></span>
                                                <select name="boyaClassSelect" id="boyaClassSelect" class="form-control col-lg-3" onclick="toastClick('info','Belirtilmediyse Class 1','')">
                                                    <option value="boyaClass" selected>CLASS 1</option>
                                                    <option value="boyaClass2">CLASS 2</option>
                                                    <option value="boyaClass3">CLASS 3</option>
                                                </select>
                                                <input type="text" class="form-control" placeholder="Marka Renk Kodu" name="markaRenkKodu" id="markaRenkKodu" oninput="this.value = this.value.toUpperCase()">
                                            </div>
                                            <div class="col-lg-3">
                                                <div class="input-group ">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text ral" id="RALspan" style="color: rgb(231, 231, 231);">...</span>
                                                        <span class="input-group-text" id="">RAL </span>
                                                    </div>
                                                    <input type="text" class="form-control" id="RALinput" maxlength="4" size="4">
                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="form-group input-group col-lg-1">
                                            <select name="boyaKalinlikSelect" id="boyaKalinlikSelect" class="form-control">
                                                <option value="boyaKalınlık" selected disabled>Kalınlık</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-1">
                                            <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control" placeholder="Boy (mm)" name="boyaBoy" min="0" id="boyaBoy">
                                        </div>
                                        <div class="form-group col-lg-3">
                                        <div class="row">
                                            <div class="input-group col-lg-5">
                                                <div class="input-group-prepend">
                                                  <span class="input-group-text checkSpan">
                                                    <input type="checkbox" class="temizCheckbox" id="boyaTemiz">
                                                  </span>
                                                </div>
                                                <input type="text" class="form-control temizInput" value="Temiz Kesim" style="background-color: transparent;" readonly>
                                            </div>
                                            <div class="col-lg-7">
                                                <input type="text" class="form-control" placeholder="Açıklama" name="boyaAciklama" id="boyaAciklama" oninput="this.value = this.value.toUpperCase()">
                                            </div>
                                        </div>    
                                        </div>
                                        
                                        <div class="form-group col-lg-1">
                                            <button type="button" id="YuzeyBoyaEkle" class="btn btn-outline-primary" >Ekle</button>
                                        </div> 
                                    </div>
                                    <div class="row">
                                        <div class="col-12 info-box">
                                            <div class="info-box-content">
                                                <div id="yuzeyBoyaTabulator"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="text" name="YuzeyBoya" class="kaydet" id="yBoyaTabData" style="display: none;" required>
                                </div>
                                <div class="tab-pane fade" id="ytab_4">
                                    <div id="ahsapTab">
                                        <div class="row">
                                            <div class="col-lg-6 form-group">
                                                <select name="ahsapKaplamaSelect" id="ahsapKaplamaSelect" class="form-control" onchange="if(this.value==0){ digerFunction('ahsapKaplamaSelect', 'ahsapKaplamaDigerDiv')}">
                                                    <option value="ahsapKaplamaSelected" id="ahsapKaplamaSelected" selected disabled>Ahşap Kaplama</option>
                                                </select>
                                                <div class="input-group" id="ahsapKaplamaDigerDiv" style="display: none;">
                                                    <input type="text" oninput="this.value = this.value.toUpperCase()" placeholder="Ahşap Kaplama" class="form-control" id="ahsapKaplamaDiger">
                                                    <div class="input-group-append">
                                                        <span  class="input-group-text" id="ahsapKaplamaDigerSpan" onclick="digerFunction('ahsapKaplamaDigerDiv', 'ahsapKaplamaSelect')"><i class="fa fa-undo" aria-hidden="true"></i></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-1">
                                                <input type="text" oninput="this.value = formatNumber(this.value)" class="form-control" placeholder="Boy (mm)" name="ahsapBoy" min="0" id="ahsapBoy">
                                            </div>
                                            <div class="col-lg-2 form-group">
                                                <div class="row">
                                                <div class="input-group col-lg-8">
                                                    <div class="input-group-prepend">
                                                      <span class="input-group-text checkSpan">
                                                        <input type="checkbox" class="temizCheckbox" id="ahsapTemiz">
                                                      </span>
                                                    </div>
                                                    <input type="text" class="form-control temizInput" value="Temiz Kesim" style="background-color: transparent;" readonly>
                                                </div>
                                                <div class="col-lg-4" >
                                                    <button type="button" id="ahsapKaplamaEkle" class="btn btn-outline-primary">Ekle</button>
                                                </div>
                                                </div>
                                            </div>
                                            <!-- <div class="col-lg-2 form-group">
                                                
                                            </div> -->
                                        </div>
                                        <div class="row">
                                            <div class="col-12 info-box">
                                                <div class="info-box-content">
                                                    <div id="ahsapKaplamaTabulator"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="text" name="YuzeyAhsap" class="kaydet" id="yAhsapTabData" style="display: none;" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_5">
                    <div class="card">
                        <div class="card-header">Talaşlı İmalat Detayları</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="btn-group btn-group-toggle col-12" data-toggle="buttons">
                                    <label class="btn btn-outline-danger">
                                      <input type="radio" class="kaydet" name="TalasliImalat" id="tVar" value="Var" autocomplete="off" required> VAR
                                    </label>
                                    <label class="btn btn-outline-danger">
                                      <input type="radio" class="kaydet" name="TalasliImalat" id="tYok" value="Yok" autocomplete="off" required> YOK
                                    </label>
                                    <label class="btn btn-outline-danger">
                                      <input type="radio" class="kaydet" name="TalasliImalat" id="tMusteri" value="Müşteri Yapacak" autocomplete="off" required> MÜŞTERİ YAPACAK
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="info-box bg-light">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">AÇIKLAMA</span>
                                        <input type="text" name="TalasliImalatAciklama" id="talasliImalatAciklama" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()">
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab_6">
                    <div class="card">
                        <div class="card-header">Paketleme Detayları</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="btn-group btn-group-toggle col-12" data-toggle="buttons">
                                    <label class="btn btn-outline-danger active">
                                      <input type="radio" name="Paketleme" class="kaydet" id="pStandart" value="Standart Palet" autocomplete="off" required> STANDART PALET
                                    </label>
                                    <label class="btn btn-outline-danger">
                                      <input type="radio" name="Paketleme" class="kaydet" id="pIhracat" value="Ihracat Palet" autocomplete="off" required> İHRACAT PALET
                                    </label>
                                    <label class="btn btn-outline-danger">
                                      <input type="radio" name="Paketleme" class="kaydet" id="pOzel" value="Ozel Paketleme" autocomplete="off" required> ÖZEL PAKETLEME
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="info-box bg-light">
                                    <div class="info-box-content">
                                        <span class="info-box-text text-center text-bold">AÇIKLAMA</span>
                                        <input type="text" name="PaketlemeAciklama" id="paketlemeAciklama" class="form-control mt-2 kaydet" oninput="this.value = this.value.toUpperCase()">
                                    </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                </div>
                <div class="tab-pane" id="tab_7">
                    <div class="card">
                        <div class="card-header">Yüklenecek Dosyalar</div>
                        <div class="card-body" id="dosyaBody">
                            <div class="row">
                                <div class="col-12">
                                    <div class="input-group border border-warning">
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input half-required" name="Dosyalar" id="fileInput" lang="tr" multiple>
                                            <label class="custom-file-label" for="fileInput" style="overflow: hidden;">Dosyaları Seçin</label>
                                        </div>
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="dosyaTemizle" onclick="DosyaTemizle()">Temizle</span>
                                        </div>
                                    </div>
                                    <div id="fileTitles" class="form-group"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </form>
        </div>
        <div class="card-footer">
            <!--  -->
            <div class="progress" style="height: 60px;">
                <div class="progress-bar bg-warning" role="progressbar"
                     aria-valuenow="0" aria-valuemin="1" aria-valuemax="100" style="width: 1%;" id="kaydetProgress">
                     <button type="button" id="yudaKaydet" class="btn btn-block bg-gradient-primary btn-lg" style="height: 100%; ">KAYDET</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function formatNumber(number) {
        number = number.replace(/[^\d,]/g, '')
        var parts = [];
        var partsWithComma = number.split(',');
        var integerPart = partsWithComma[0].replace(/\D/g, ''); // Remove non-numeric characters from integer part

        while (integerPart.length > 3) {
            parts.unshift(integerPart.slice(-3));
            integerPart = integerPart.slice(0, -3);
        }
        if (integerPart) {
            parts.unshift(integerPart);
        }
        let a = parts.join('.');
        if (partsWithComma.length > 1) {
            a += (',' + partsWithComma[1].replace(/[^\d]/g, '')); // Remove non-numeric characters from decimal part
        }

        return a;
    }

    function checkRequiredField(i, allFilled) {
        let sType = i.attr('type') || i.prop('type');
        if (sType == 'text') {
            if (i.val() === '') {
                allFilled = false; 
            }
        }
        else if (sType == 'radio') {
            let $radioLabels = i.closest('.btn-group-toggle').find('label');
            let isChecked = i.is(':checked');
            $radioLabels.each(function() {
                let $label = $(this);
                if (isChecked && !$label.hasClass('btn-outline-primary')) {
                    $label.removeClass('btn-outline-danger').addClass('btn-outline-primary');
                }
                else if(!isChecked && !$label.hasClass('btn-outline-primary')){
                    allFilled = false;
                }
            });
        }
        else if (sType == 'select-multiple') {
            let results = [];
            let opt;
            for (let j=0; j< i[0].options.length; j++){
                opt = i[0].options[j]
                if(opt.selected){results.push(opt.value);}
            };
            if (results.length == 0) {
                allFilled = false;
            }
        }
        else if (sType == 'select-one') {
            console.log("select onee"); // bir kere seçtikten sonra seçimi kaldıramadıklarından bir şey eklememe gerek yok, false olma durumu olmuyor.
        }
        else if (sType == 'file') {
            console.log("file type"); // dosyaları aşağıda updateFile vs functionlarında hallettim
        }

        return allFilled;
    };

    $('input[name="ProjeTipi"]').on('change', function() {
        if ($('#mevcutProfil').is(':checked')) {
            document.getElementById('profilRow').style.display = 'block';
            $("#profilSelect").attr('required', '');
            $('#profilSelect').select2({
                placeholder: 'Profil Seçiniz',
                minimumInputLength: 1,  // Start searching after typing 1 character
                language: {
                    inputTooShort: function () {
                        return "Lütfen en az 1 karakter giriniz..";
                    }
                },
                ajax: {
                    url: '/yuda/profil/',
                    dataType: 'json',
                    delay: 250,  // Wait for 250ms after typing to send the request
                    data: function(params) {
                        return {
                            query: params.term // The search term
                        };
                    },
                    processResults: function(data, params) {
                        // Map the response data to the required Select2 format
                        return {
                            results: data.profiles.map(function(profile) {
                                return {
                                    id: profile.id,
                                    text: profile.name
                                };
                            })
                        };
                    }
                }
            });
        }
        else {
            $("#profilSelect").removeAttr('required');
            document.getElementById('profilRow').style.display = 'none';
        }
    });

    $(':input[required]').on('change', function() {
        let allFilled = true;
        let $infoBox = $(this).closest('.required-info');
        if ($infoBox.length == 0){$infoBox = $(this).closest('.validated');}
        if ($infoBox.length == 0){
            allFilled = checkRequiredField($(this), allFilled);
        }
        else {
            let checkResult = false;
            let $reqInputs = $infoBox.find('[required]');
            $reqInputs.each(function(r) {
                allFilled = checkRequiredField($(this), allFilled);
            });
        }
        if (allFilled) {
            $infoBox.addClass('validated').removeClass('required-info');
        } else {
            $infoBox.removeClass('validated').addClass('required-info');
        } 
    });
    
    var formData = new FormData();
    var full = false;
    function changeFunction () {
        let requiredElements = document.getElementById("yudaForm").querySelectorAll("[required]");
            let req = 0;
            for(var i = 0; i < requiredElements.length; i++) {
                if (requiredElements[i].validity.valid){
                    req++;
                }
            }
            let yuzde = req*100/requiredElements.length;
            // if (yuzde <= 100){yuzde = 100;}
            document.getElementById('kaydetProgress').style.width = yuzde +'%';
            if(yuzde >= 100 ){
                if(full == false){
                    setTimeout(function(){
                        document.getElementById('kaydetProgress').style.width = '0%';
                        setTimeout(function(){$('#yudaKaydet').show();
                            document.getElementById('kaydetProgress').style.width = '100%';
                        }, 600);

                    }, 600);
                    full = true;
                };
                
            }
            else {
                $('#yudaKaydet').hide();
                full = false;
        }
        
    };

    $(':input, .select').on('edit change', function(){changeFunction()});

    $('.checkSpan').click(
        function() {
            var cb = $(this).find(":checkbox")[0];

            if (!$(cb).attr("checked")) {
                $(cb).attr("checked", "checked");
                if(this.id=="metreSpan"){
                    /* $('#matInputDiv').show(); */
                    $('#minMAT, #maxMAT').show();
                    $('#minMAT, #maxMAT').prop('required', true);
                    changeFunction();
                }
            } else {
                $(cb).removeAttr("checked");
                if(this.id=="metreSpan"){
                    /* $('#matInputDiv').hide(); */
                    $('#minMAT, #maxMAT').hide();
                    $('#minMAT, #maxMAT').prop('required', false);
                    changeFunction();
                }
            }
            
        }
    );

    $('.checkSpan .temizCheckbox').click(
        function(event){
            event.stopPropagation();
    });
    
    function toastClick(iconInput, titleInput, position){
        toastr.remove();
        toastr.options ={
            "timeOut" : 2000,
            "extendedTimeOut" : 0,
            "progressBar" : true,
            "showMethod" : 'slideDown',
            "hideMethod" : 'slideUp',
        }
        var pos = {"":"toast-top-right", "oc":"toast-orta-center", "br":"toast-bottom-right", "tc":"toast-top-center"};
        let posi = pos[position];

        if(iconInput=="success"){
            toastr.success(titleInput,"",{"positionClass": posi})
        }
        else if(iconInput=="info"){
            toastr.info(titleInput,"BİLGİ",{"positionClass": posi})
        }
        else if(iconInput=="error"){
            toastr.error(titleInput,"",{"positionClass": posi})
        }
        else if(iconInput=="warning"){
            toastr.warning(titleInput,"DİKKAT",{"positionClass": posi})
        }
    }

    var deleteIcon = function(cell, formatterParams, onRendered){ 
        return "<i class='fa fa-trash'></i>";
    };

    var alasimTab = new Tabulator("#alasimTabulator", {
        layout:"fitColumns",
        data:[],
        movableRows:true,
        placeholder:"1. Tercih üstte olacak şekilde sıralayınız",
        columns:[
            {rowHandle:true, formatter:"handle", headerSort:false, frozen:true, width:30, minWidth:30},
            {title:"Alaşım", field:"Alasim"},
            {title:"Kondüsyon", field:"Kondusyon"},
            {title:"AlaşımID", field:"AlasimID", visible:false},
            {title:"KondüsyonID", field:"KondusyonID", visible:false},
            {formatter:deleteIcon, width:40, hozAlign:"center", headerSort:false ,cellClick: function (e, cell) {
                cell.getRow().delete();
                $('#alasimTabData').val(JSON.stringify(alasimTab.getData()));
                if(alasimTab.getData().length == 0){
                    $('#alasimTabData').prop('required', true);
                    $('#AlasimKondusyonEkle').removeClass('btn-outline-primary');
                    $('#AlasimKondusyonEkle').addClass('btn-outline-danger');
                }
                changeFunction();
            }
            }
        ],
    });

    var yuzeyPresTabulator = new Tabulator('#yuzeyPresTabulator', {
        layout:"fitColumns",
        data:[],
        movableRows:true,
        placeholder:"1.Tercih üstte olacak şekilde sıralayınız",
        columns:[
            {rowHandle:true, formatter:"handle", headerSort:false, frozen:true, width:30, minWidth:30},
            {title:"Yüzey Detay", field:"YuzeyDetay"},
            {title:"Boy", field:"YuzeyPresBoy"},
            {formatter:deleteIcon, width:40, hozAlign:"center", headerSort:false, cellClick:function (e, cell) {
                cell.getRow().delete();
                $('#yPresTabData').val(JSON.stringify(yuzeyPresTabulator.getData()));
                checkNull();
            }}
        ]
    });

    var eloksalTabulator = new Tabulator("#eloksalTabulator", {
        layout:"fitColumns",
        data:[],
        movableRows:true,
        placeholder:"1. Tercih üstte olacak şekilde sıralayınız",
        columns:[
            {rowHandle:true, formatter:"handle", headerSort:false, frozen:true, width:30, minWidth:30},
            {title:"Matlaştırma", field:"Matlastirma"},
            {title:"Renk", field:"Renk"},
            {title:"Kaplama Kalınlığı", field:"KaplamaKalinligi"},
            {title:"Boy", field:"EloksalBoy"},
            {title:"Temiz Kesim", field:"EloksalTemizKesim"},
            {title:"Matlaştırma ID", field:"MatlastirmaID", visible:false},
            {title:"Renk ID", field:"RenkID", visible:false},
            {title:"Kaplama Kalınlığı ID", field:"KaplamaKalinligiID", visible:false},
            {formatter:deleteIcon, width:40, hozAlign:"center", headerSort:false, cellClick:function (e, cell) {
                cell.getRow().delete();
                $('#yEloksalTabData').val(JSON.stringify(eloksalTabulator.getData()));
                checkNull();
            }}
        ]
    });

    var yuzeyBoyaTabulator = new Tabulator("#yuzeyBoyaTabulator", {
        layout:"fitColumns",
        data:[],
        movableRows:true,
        placeholder:"1. Tercih üste olacak şekilde sıralayınız",
        columns:[
            {rowHandle:true, formatter:"handle", headerSort:false, frozen:true, width:30, minWidth:30},
            {title:"Tür", field:"Tur"},
            {title:"Marka", field:"Marka"},
            {title:"Class", field:"BoyaClass"},
            {title:"Marka Renk Kodu", field:"MarkaRenkKodu"},
            {title:"RAL", field:"Ral"},
            {title:"Tür ID", field:"TurID", visible:false},
            {title:"Marka ID", field:"BoyaMarkaID", visible:false},
            {title:"Kalınlık", field:"BoyaKalinlik"},
            {title:"Kalınlık ID", field:"BoyaKalinlikID", visible:false},
            {title:"Boy", field:"BoyaBoy"},
            {title:"Temiz Kesim", field:"BoyaTemizKesim"},
            {title:"Açıklama", field:"BoyaAciklama"},
            {formatter:deleteIcon, width:40, hozAlign:"center", headerSort:false, cellClick:function (e, cell) {
                cell.getRow().delete();
                $('#yBoyaTabData').val(JSON.stringify(yuzeyBoyaTabulator.getData()));
                checkNull();
            }}
        ]
    });

    var ahsapKaplamaTabulator = new Tabulator("#ahsapKaplamaTabulator", {
        layout:"fitColumns",
        data:[],
        movableRows:true,
        placeholder:"1. Tercih üste olacak şekilde sıralayınız",
        columns:[
            {rowHandle:true, formatter:"handle", headerSort:false, frozen:true, width:30, minWidth:30},
            {title:"Ahşap Kaplama", field:"AhsapKaplama"},
            {title:"Ahşap Kaplama ID", field:"AhsapKaplamaID", visible:false},
            {title:"Boy", field:"AhsapBoy"},
            {title:"Temiz Kesim", field:"AhsapTemizKesim"},
            {formatter:deleteIcon, width:40, hozAlign:"center", headerSort:false, cellClick:function (e, cell) {
                cell.getRow().delete();
                $('#yAhsapTabData').val(JSON.stringify(ahsapKaplamaTabulator.getData()));
                checkNull();
            }}
        ]
    });

    function checkNull(){
        if(ahsapKaplamaTabulator.getData().length == 0 && yuzeyBoyaTabulator.getData().length == 0 && eloksalTabulator.getData().length == 0 && yuzeyPresTabulator.getData().length == 0){
            $('#yAhsapTabData, #yEloksalTabData, #yPresTabData, #yBoyaTabData').prop('required', true);
        }
        else{
            $('#yAhsapTabData, #yEloksalTabData, #yPresTabData, #yBoyaTabData').removeAttr('required');
        }
        changeFunction();
    }

    $('#metreCheck').on('change.bootstrapSwitch', function(e) {
        let metreC = e.target.checked;
        if (!metreC){
            $('#minMAT, #maxMAT').attr('disabled', 'disabled');
        }
        else {
            $('#minMAT, #maxMAT').removeAttr('disabled');
        }
    });


    function digerFunction(selectId, digerId){
        $('#'+selectId).hide();
        if(selectId.includes('Select')){
            $('#'+selectId).val(selectId+'ed');
        };
        $('#'+digerId).show();
    }; /* texti kapatmak için de bunu çağır */

    function selectFunction(objId, target, title, diger) {
        if (objId == 0){
            if(target != ""){
                selectFunction(target, target, title, "Diğer");
            }
                $('#'+ title+'Div').show();
        }else{
            if ($('#'+ title+'Div').is(':visible')){
                $('#'+ title+'Diger').val("");
                $('#'+ title+'Div').hide();
            }
            if(target != "") {
                    $.ajax({
                    url: `/yuda/${objId}`,
                    method: 'GET',
                    dataType: 'json',
                    success: function (Data) {
                        $('#'+target+'ed').nextAll().remove();
                        
                        $.each(Data, function(key, value) {
                            $('#'+target+'').append('<option value=' + value.id + '>' + value.Isim + '</option>');
                        });
                        if(diger){
                            $('#'+target+'').append('<option value="0">'+ diger +'</option>')
                        }
                    },
                    error: function (error) {
                        console.error('Error loading select data:', error);
                    }
                });
            }
        }
    };

    selectFunction(1, "alasimSelect", "Alaşım", "Diğer");
    selectFunction(20, "matlastirmaSelect", "Matlaştırma", "");
    selectFunction(59,"eloksalKaplamaKalinligiSelect", "Kaplama Kalınlığı", "");
    selectFunction(67, "turSelect", "Tür", "");
    selectFunction(73, "ahsapKaplamaSelect", "Ahşap Kaplama", "Diğer");
    selectFunction(106, "boyaKalinlikSelect", "Boya Kalınlık", "");
    selectFunction(112, "boyaMarkaSelect", "Marka", "Diğer");
    /* bütün selectler için arraya alıp for yap */
    /* ekleye tıklatınca tabulatore eklesin inputlardakileri de veritabanına kaydet*/

    document.getElementById("AlasimKondusyonEkle").addEventListener("click", function(){
        /* AlaşımDiger ve KondüsyonDigeri arraye alıp for döndürüp tek if else ile yapılabilir */
        let alasimID, kondusyonID, alasim, kondusyon = "";
        if (document.getElementById("alasimDigerDiv").style.display == "none") {
            alasimID = $('#alasimSelect').val();
            alasim = $('#alasimSelect option:selected').text();
        }
        else {
            alasim =$('#alasimDiger').val();
        }
        if(document.getElementById("kondusyonDigerDiv").style.display == "none"){
            kondusyonID = $('#kondusyonSelect').val();
            kondusyon = $('#kondusyonSelect option:selected').text();
        }
        else {
            kondusyon = $('#kondusyonDiger').val();
        }
        if(alasim!="Alaşım* " && kondusyon!="Kondüsyon* "){
            alasimTab.addData({AlasimID:alasimID, KondusyonID:kondusyonID, Alasim:alasim, Kondusyon:kondusyon});
            $('#alasimTabData').val(JSON.stringify(alasimTab.getData()));
            $('#alasimTabData').removeAttr('required');
            if ($('#AlasimKondusyonEkle').hasClass('btn-outline-danger')) {
                $('#AlasimKondusyonEkle').removeClass('btn-outline-danger');
                $('#AlasimKondusyonEkle').addClass('btn-outline-primary');
            }
            changeFunction();
        }
    });

    document.getElementById("YuzeyPresEkle").addEventListener("click", function(){
        let yPresSelect, yPresBoy = "";
        if($('#yuzeyPresSelect').val() != null && $('#yuzeyPresBoy').val()!=""){
            yPresSelect = $('#yuzeyPresSelect').val();
            yPresBoy = $('#yuzeyPresBoy').val();

            yuzeyPresTabulator.addData({YuzeyDetay:yPresSelect, YuzeyPresBoy:yPresBoy}, false);
            $('#yPresTabData').val(JSON.stringify(yuzeyPresTabulator.getData()));
            checkNull();
        }
    });

    document.getElementById("YuzeyEloksalEkle").addEventListener("click", function(){
        let matlastirma, renk, kalinlik, eBoy, eTemiz, matlastirmaId, renkId, kalinlikId = "";
        if($('#matlastirmaSelect').val() != null && $('#eloksalRenkSelect').val() != null && $('#eloksalKaplamaKalinligiSelect').val() != null && $('#eloksalBoy').val()!=""){
            matlastirma = $('#matlastirmaSelect option:selected').text();
            renk =  $('#eloksalRenkSelect option:selected').text();
            kalinlik =  $('#eloksalKaplamaKalinligiSelect option:selected').text();
            eBoy = $('#eloksalBoy').val();
            if($('#eloksalTemiz').is(':checked')){
                eTemiz = "Temiz Kesim";
                $("#tVar").prop("checked", true).trigger("click");
                $("#talasliImalatAciklama").val("Temiz kesim yapılacak.");
            }
            else{
                eTemiz = "Temiz Kesim Değil";
            }
            matlastirmaId = $('#matlastirmaSelect').val();
            renkId =  $('#eloksalRenkSelect').val();
            kalinlikId =  $('#eloksalKaplamaKalinligiSelect').val();
            eloksalTabulator.addData({Matlastirma:matlastirma, Renk:renk, KaplamaKalinligi:kalinlik, EloksalBoy:eBoy, EloksalTemizKesim:eTemiz, MatlastirmaID:matlastirmaId, RenkID: renkId, KaplamaKalinligiID:kalinlikId}, false);
            $('#yEloksalTabData').val(JSON.stringify(eloksalTabulator.getData()));
            checkNull();
        }
    });

    document.getElementById("YuzeyBoyaEkle").addEventListener("click", function(){
        let boyaMarka, boyaMarkaID, bTemiz, boyaKalinlik, boyaKalinlikID = "";
        if(document.getElementById("boyaMarkaDiger").style.display == "none"){
            boyaMarka = $('#boyaMarkaSelect option:selected').text();
            boyaMarkaID = $('#boyaMarkaSelect').val();
        }
        else{
            boyaMarka = $('#boyaMarkaDiger').val();
        }
        if($('#boyaTemiz').is(':checked')){
            bTemiz = "Temiz Kesim";
            $("#tVar").prop("checked", true).trigger("click");
            $("#talasliImalatAciklama").val("Temiz kesim yapılacak.");
        }
        else{
            bTemiz = "Temiz Kesim Değil";
        }
        if($('#boyaKalinlikSelect').val() != null){
            boyaKalinlik = $('#boyaKalinlikSelect option:selected').text();
            boyaKalinlikID = $('#boyaKalinlikSelect').val();
        }
        if($('#RALinput').val() != "" && $('#boyaBoy').val() != "" && $('#turSelect').val() != null){
            yuzeyBoyaTabulator.addData({Tur: $('#turSelect option:selected').text(), TurID: $('#turSelect').val(), Marka: boyaMarka, MarkaID: boyaMarkaID, BoyaClass:$('#boyaClassSelect option:selected').text(), 
            MarkaRenkKodu: $('#markaRenkKodu').val(), Ral:$('#RALinput').val(), BoyaKalinlik: boyaKalinlik, BoyaKalinlikID: boyaKalinlikID, 
            BoyaBoy:$('#boyaBoy').val(), BoyaTemizKesim:bTemiz, BoyaAciklama: $('#boyaAciklama').val()}, false);
            $('#yBoyaTabData').val(JSON.stringify(yuzeyBoyaTabulator.getData()));
            checkNull();
        }
    });

    document.getElementById("ahsapKaplamaEkle").addEventListener('click', function(){
        let ahsapKaplama, ahsapKaplamaId, aTemiz = "";
        if($('#ahsapTemiz').is(':checked')){
            aTemiz = "Temiz Kesim";
            $("#tVar").prop("checked", true).trigger("click");
            $("#talasliImalatAciklama").val("Temiz kesim yapılacak.");
        }
        else{
            aTemiz = "Temiz Kesim Değil";
        };
        if(document.getElementById("ahsapKaplamaDigerDiv").style.display == "none"){
            ahsapKaplama = $('#ahsapKaplamaSelect option:selected').text();
            ahsapKaplamaID = $('#ahsapKaplamaSelect').val();
        }
        else{
            ahsapKaplama = $('#ahsapKaplamaDiger').val();
        }
        if(ahsapKaplama != "" && ahsapKaplama != "Ahşap Kaplama" && $('#ahsapBoy').val() != ""){
            ahsapKaplamaTabulator.addData({AhsapKaplama:ahsapKaplama, AhsapKaplamaID:ahsapKaplamaId, AhsapBoy:$('#ahsapBoy').val(), AhsapTemizKesim:aTemiz}, false);
            $('#yAhsapTabData').val(JSON.stringify(ahsapKaplamaTabulator.getData()));
            checkNull();
        }
    });


    $('#RALinput').keyup(function() {
        let defaultClass = "input-group-text ral"
        if ($('#RALinput').val().length === 4 ) {
            let ral = "input-group-text ral"+$('#RALinput').val();
            document.getElementById('RALspan').setAttribute("class", ral)
        }
        else {
            document.getElementById('RALspan').setAttribute("class", defaultClass);
        }
    });

    $("input[data-bootstrap-switch]").each(function(){
      $(this).bootstrapSwitch('state', $(this).prop('checked'));
    });

    $(document).ready(function () {
        bsCustomFileInput.init();
    });

    //Initialize Select2 Elements
    $('.select2bs4').select2({
      theme: 'bootstrap4'
    });

    var selectedFiles = [];
    $('#fileInput').on('change', function(e) {
        Array.from(e.target.files).forEach(function(newFile) {
            if (!fileAlreadySelected(newFile)) {
                selectedFiles.push(newFile);
            }
        });
        updateFileList();
        toggleRequiredInfo();
    });

    function fileAlreadySelected(newFile) {
        return selectedFiles.some(function(existingFile) {
            return newFile.name === existingFile.name && newFile.size === existingFile.size;
        });
    }

    function validateFiles() {
        if (selectedFiles.length === 0) {
            $('#fileInput').val('');
            $('#fileInput').next('label').html('Dosyaları Seçin');
            changeFunction();
            toggleRequiredInfo();
        }
        return true;
    }

    function updateFileList() {
        validateFiles();
        var fileTitles = $('#fileTitles');
        fileTitles.empty(); // Önceki başlık alanlarını temizle

        var row = $('<div class="row"></div>');
		fileTitles.append(row);

        selectedFiles.forEach(function(file, index){
            let fileType = file.name.split(".").pop().toLowerCase();
            var column = $(
                `<div class="col-md-6 mt-3">
                    <div class="mp-3 d-flex justify-content-between border rounded">
                        <span class="fiv-cla fiv-icon-${fileType} border-right-0" rounded-left"></span>
                        <div class="p-1 flex-grow-1">
                            <label class="overflow">${file.name}</label>
                            <select class="form-control kaydet" name="fileTitles[]">
                                <option value="Diğer">Diğer</option>
                                <option value="Teknik Resim">Teknik Resim</option>
                                <option value="Şartname">Şartname</option>
                                <option value="Paketleme Talimatı">Paketleme Talimatı</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-lg rounded-right" onclick="removeFile(${index})">
                            <i class="fas fa-times fa-spin-hover fa-lg text-danger"></i>
                        </button>
                    </div>
                </div>`
            );

            row.append(column);

            if ((index + 1) % 2 === 0 && index + 1 < selectedFiles.length) {
                row = $('<div class="row"></div>');
                fileTitles.append(row);
            }
        });

    };

    function toggleRequiredInfo() {
        var fileInput = document.getElementById('fileInput');
        var inputGroup = fileInput.closest('.input-group');
        if (selectedFiles.length === 0) {
            inputGroup.classList.add('border', 'border-warning');
        } else {
            inputGroup.classList.remove('border', 'border-warning');
        }
    }
    
    window.removeFile = function(index) {
        selectedFiles.splice(index, 1);
        updateFileList();
        toggleRequiredInfo();
    };

    function DosyaTemizle(){
        selectedFiles = [];
        $('#fileInput').val('');
        $('#fileInput').next('label').html('Dosyaları Seçin');
        //document.getElementById("fileInput").validity.valid = false;
        changeFunction();
        updateFileList();
        toggleRequiredInfo();
    };

    document.querySelector("#yudaKaydet").addEventListener('click', function(){
        let halfElements = document.getElementById("yudaForm").querySelectorAll(".half-required"); // half-required elementlerin boş değerli olanlarına bu olmadan kaydetmek istediğinize emin misiniz desin
        var saveConfirm = true;
        if (selectedFiles.length === 0) {
            saveConfirm = confirm("Dosya eklemeden kaydetmek istediğinize emin misiniz?");
        }
        if (saveConfirm) {
            this.disabled = true;
            var formData = new FormData();
            formData.append("csrfmiddlewaretoken", "{{csrf_token}}");

            selectedFiles.forEach(function(file) {
                formData.append('files[]', file);
            });

            let formElements = document.getElementById("yudaForm").querySelectorAll(".kaydet");
            var values = {};
                
            
            for(let i = 0; i < formElements.length; i++) {
                if (formElements[i].type == "radio") {
                    if($('#'+formElements[i].id).is(':checked')){
                        values[formElements[i].name] = formElements[i].value;
                        formData.append([formElements[i].name], formElements[i].value);
                    }
                }
                else if (formElements[i].type == "checkbox" ) {
                    if ($('#'+formElements[i].id).is(':checked')){
                        if (formElements[i].name == "MetreAgirlikTalebi"){
                            values[formElements[i].name] = "Var";
                            formData.append([formElements[i].name], "Var");
                        }
                        else {
                            values[formElements[i].name] = "Temiz Kesim";
                            formData.append([formElements[i].name], "Temiz Kesim");
                        };
                    }
                    else {
                        if (formElements[i].name == "MetreAgirlikTalebi"){
                            values[formElements[i].name] = "Yok";
                            formData.append([formElements[i].name], "Yok");
                        }
                        else {
                            values[formElements[i].name] = "Temiz Kesim Değil";
                            formData.append([formElements[i].name], "Temiz Kesim Değil");
                        };
                    }
                }
                else if (formElements[i].type == "select-multiple"){
                    let results = [];
                    let opt;
                    for (let j=0; j< formElements[i].options.length; j++){
                        opt = formElements[i].options[j]
                        if(opt.selected){results.push(opt.value);}
                    };
                    values[formElements[i].name] = results;
                    formData.append([formElements[i].name], results);
                }
                else{
                    values[formElements[i].name] = formElements[i].value;
                    formData.append([formElements[i].name], formElements[i].value);
                }
            };

            console.log("Form Data Entries:");
            for (let pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }
            
            $.ajax({
                url: '/yudakaydet',
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    // Başarılı yükleme sonrası işlemler
                    alert(''+response.message);
                    window.location.href = "/yudaDetail/"+response.id;
                },
                error: function(response) {
                    // Hata durumunda işlemler
                    this.disabled = false;
                    alert('Kayıt başarısız oldu. '+response.responseJSON.error);
                }
            });

        }
        
    });


</script>
{% endblock %}

{% block javascript %}
{% include 'adminlte/lib/_scripts.html' %}
<script src="{% static 'tabulator/dist/js/tabulator.js' %} "></script>
<script src="{% static 'admin-lte/plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'admin-lte/plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/bs-custom-file-input/bs-custom-file-input.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/sweetalert2/sweetalert2.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/toastr/toastr.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/select2/js/select2.full.min.js' %}"></script>
{% endblock %}
